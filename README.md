# Lispy

![CI](https://github.com/fuodorov/lispy/actions/workflows/ci.yml/badge.svg)

Компактный интерпретатор Scheme (Lisp), написанный на Python.

## Возможности

- **Ядро Scheme**: Поддержка лямбда-исчисления, лексических областей видимости (closures), `define`, `set!`, `if`, `quote`.
- **Типы данных**: Числа (int, float, complex), строки, символы, списки, булевы значения (`#t`, `#f`).
- **Синтаксический сахар**: Комментарии (`;`), цитирование (`'`), квазицитирование (`` ` ``, `,`, `,@`).
- **Макросы**: Гигиенические макросы через `define-macro`. Встроенные макросы: `let`, `and`.
- **Оптимизация**: Оптимизация хвостовой рекурсии (TCO) позволяет выполнять бесконечные циклы без переполнения стека.
- **Продолжения**: Поддержка `call/cc` (call-with-current-continuation).
- **Обработка ошибок**: Информативные сообщения об ошибках с использованием кастомных классов исключений.
- **Модульность**: Код разделен на логические модули для удобства поддержки и расширения.

## Структура проекта

```
lispy/
    __init__.py    # Инициализация пакета
    types.py       # Типы данных (Symbol, Exp, Atom)
    errors.py      # Классы исключений
    parser.py      # Токенизатор и парсер
    env.py         # Окружение (Environment)
    evaluator.py   # Вычислитель (eval)
    macros.py      # Система макросов
    primitives.py  # Стандартная библиотека функций
    repl.py        # Read-Eval-Print Loop
tests/
    test_integration.py # Интеграционные тесты
    test_parser.py      # Юнит-тесты парсера
    test_env.py         # Юнит-тесты окружения
```

## Установка и запуск

### Требования
- Python 3.8+

### Запуск REPL
Чтобы запустить интерактивную оболочку:

```bash
python3 -m lispy
```

Пример сессии:
```scheme
lispy> (define r 10)
None
lispy> (* 3.141592653 (* r r))
314.1592653
lispy> (define (fact n) (if (<= n 1) 1 (* n (fact (- n 1)))))
None
lispy> (fact 10)
3628800
```

### Запуск файла
```bash
python3 -m lispy my_script.scm
```

## Разработка

Для установки зависимостей разработки (тесты, линтеры):

```bash
pip install -r requirements/dev.txt
```

### Тестирование

Запуск всех тестов:

```bash
pytest
```

### Линтинг

Проект использует `flake8` для проверки стиля и `isort` для сортировки импортов.

```bash
# Проверка стиля
flake8 .

# Автоматическая сортировка импортов
isort .
```

### CI/CD

Настроена автоматическая проверка кода (Linting) и запуск тестов (Testing) через GitHub Actions. Тесты запускаются только после успешного прохождения линтеров.

## Документация

Проект содержит подробную документацию, сгенерированную с помощью [Sphinx](https://www.sphinx-doc.org/).

### Просмотр онлайн
Актуальная версия документации доступна на GitHub Pages:
[https://fuodorov.github.io/lispy/](https://fuodorov.github.io/lispy/)

### Сборка локально
Для сборки документации локально выполните:

```bash
# Установка зависимостей для документации
pip install -r requirements/docs.txt

# Сборка HTML версии
sphinx-build -b html docs docs/_build/html
```
После сборки откройте файл `docs/_build/html/index.html` в браузере.

## Реализованные фичи (Checklist)

- [x] Базовый синтаксис и семантика Scheme
- [x] REPL
- [x] Арифметика и математические функции
- [x] Строки и комментарии
- [x] Макросы (`define-macro`)
- [x] `let`, `and`, `or` (через макросы)
- [x] Хвостовая рекурсия (TCO)
- [x] `call/cc`
- [x] Обработка ошибок (Custom Exceptions)
- [x] Модульная архитектура
- [x] Покрытие тестами


## Ссылки
Данный проект основан на книге "Structure and Interpretation of Computer Programs" и реализации lispy, представленной в ней, а также на статье Питера Норвига "How to Write a (Lisp) Interpreter (in Python)".